<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>비트캠프 데브옵스 5기</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  <link rel="stylesheet" type="text/css" href="/css/common.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css">
  <style>

    * {
      font-family: "Noto Sans KR";
      font-weight: 400;
    }

    #main-container {
      text-align: center;
      font-size: 20px;
      padding-top: 20px;
      border: 0.5px solid #CCCCCC;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }


    .state-form {
      max-width: 400px;
      margin: 30px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }

    .state-form h1 {
      font-size: 24px;
    }

    .state-select {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 10px;
    }

    .status-button {
      background-color: #35C5B3;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .input-file-button:hover,
    .status-button:hover {
      background-color: #1C9189;
    }



    .image-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      border: 0.5px solid #ddd;
      border-radius: 8px;
      box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.2);
      min-height: 282px;

    }

    .image-wrapper {
      display: flex;
      flex-direction: column;
      margin: auto 0;
      position: relative;
      width: calc(20% - 16px);
    }

    .image-item {
      width: 100%;
      max-height: 220px;
      min-height: 220px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .image-description {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      color: #555;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      margin: 10px 0 0 0 !important;
    }


    .delete-button {
        background-color: red;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        position: absolute;
        top: 0;
        right: 0;
        border-radius: 5px;
    }


    .basic-info {
      width: 500px;
    }

    .location-info {
      width: 50%;
    }


    .input-file-button{
      padding: 6px 25px;
      background-color:#35C5B3;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }


    .room-theme,
    .room-type {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      width: 60%;
      margin: 30px auto;
    }

    .type-option {
      flex: 1 1 calc(20% - 10px);
      width: 100px;
      height: 100px;
      border: 2px solid #CCCCCC;
      border-radius: 10px;
      margin-right: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      padding: 10px 0;
      justify-content: center;
    }

    .theme-option {
      flex: 1 1 calc(20% - 10px);
      width: 60%;
      border: 2px solid #CCCCCC;
      border-radius: 10px;
      margin-right: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      padding: 10px 0;
      justify-content: center;
    }

    .icon {
      border-radius: 5px;
    }

    input[type="checkbox"],
    input[type="radio"] {
      display: none;
      -webkit-appearance: none; /* Chrome, Safari, Edge 등의 웹킷 기반 브라우저 */
      -moz-appearance: none; /* Firefox 브라우저 */
      appearance: none; /* 일반적인 브라우저 */
    }

    .theme-option.selected,
    .type-option.selected {
      border: 4px solid #35C5B3;
    }

    #basic-facility {
        display: flex;
        justify-content: center;
        flex-direction: column;
        text-align: center;
        margin: 25px auto;
      }

      .convenience-facility {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        width: 60%;
        margin: 25px auto;

      }

      .facility-option {
        flex: 1 1 calc(20% - 10px);
        width: 100px;
        height: 100px;
        border: 2px solid #CCCCCC;
        border-radius: 10px;
        margin-right: 10px;
        margin-bottom: 10px;
        cursor: pointer;
        padding: 10px 0;
        justify-content: center;
      }

      .quantity {
        margin: 20px auto;
        font-size: 20px;
        border-bottom: 2px solid #CCCCCC;
        padding-bottom: 30px;
        max-width: 550px;
        text-align: center;
      }

      input[type=number]::-webkit-inner-spin-button,
      input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;/* input type:number 마우스오버시 보이는 화살표 제거 */
      }

      .fa-solid {
        font-size: 25px;
        margin: 15px;
      }

      .facility-option.selected {
        border-color: #35C5B3;
      }

      #default-image {
        display: none;
      }

    /* 지도 */
    #map {
      height: 600px;
      border-radius: 5px;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    textarea,
    input[type=date],
    input[type=text],
    input[type=number] {
      background-color: #fff;
      border: 0;
      border-radius: 2px;
      box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
      margin: 10px;
      padding: 0.5em;
      overflow: hidden;
      font-size: 16px;
      min-width: 25%;
    }

    input[type=button] {
      background-color: #fff;
      border: 0;
      border-radius: 2px;
      box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
      margin: 10px;
      padding: 0.5em;
      font-weight: 200;
      overflow: hidden;
      cursor: pointer;
      font-size: 15px;
      margin-left: 5px;
    }

    input[type=button]:hover {
      background: rgb(235, 235, 235);
    }

    input[type=button].button-primary {
      background-color: #35C5B3;
      color: white;
    }

    input[type=button].button-primary:hover {
      background-color: #1765cc;
    }

    input[type=button].button-secondary {
      background-color: white;
      color: #35C5B3;
    }

    input[type=button].button-secondary:hover {
      background-color: #d2e3fc;
    }
    #response {
      margin: 5px;
      font-size: 15px;
    }

    #response-container {
      background-color: #fff;
      border: 0;
      border-radius: 2px;
      box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
      padding: 0 0.5em;
      font: 400 18px Roboto, Arial, sans-serif;
      overflow: hidden;
      margin: 10px;
      overflow: auto;
      max-width: 90%;
      background-color: rgba(255, 255, 255, 0.95);
      font-size: small;
    }

    #instructions {
      background-color: #fff;
      border: 0;
      border-radius: 2px;
      box-shadow: 0 1px 4px -1px rgba(0, 0, 0, 0.3);
      margin: 10px;
      padding: 0.5em;
      font: 400 18px Roboto, Arial, sans-serif;
      overflow: hidden;
      padding: 1rem;
      font-size: medium;
    }

    button[type="button"] {
    color: white;
    background-color: #FF99B3;
    border: none;
    border-radius: 4px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    margin-right: 30px;
    }

    button[type="button"]:hover {
      transition: background-color 0.3s ease;
      background-color: #FF66A3;
    }

    #modalButton {
      background-color: #35C5B3;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-left: 30px;
    }

    #modalButton:hover {
      background-color: #1C9189;
    }

    #modalWrap {
      position: fixed;
      z-index: 1;
      padding-top: 250px;;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
    }

    #modalBody {
      text-align: center;
      font-size: 23px;
      width: 700px;
      height: auto;
      padding: 20px;
      margin: 0 auto;
      border: 1px solid #777;
      background-color: #fff;
      border-radius: 8px;
   }

    #saveButton {
      font-weight: bold;
      color: #fff;
      background-color: #35C5B3;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
      margin-right: 15px;
    }


    #closeButton {
      font-weight: bold;
      color: #fff;
      background-color: #FA5858;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 30px;
      margin-left: 15px;
    }


    #submitButton:hover,
    #closeButton:hover {
    background-color: #1C9189;
  </style>
</head>

<body>

<div data-th-replace="host/hostHeader :: hostHeader">머리말</div>
<br>

<div id="main-container" class="container-sm">
  <form action="update" data-th-action="@{rentalHomeStateUpdate}" enctype='multipart/form-data'
        method='post' data-th-object="${rentalHome}" class="state-form">

    <input type="hidden" data-th-value="*{rentalHomeNo}" id="rentalHomeNo" name="rentalHomeNo" value="1"/>

    <h1>숙소 상태 관리</h1>

    <input type="hidden" id="state" value="0" data-th-value="${rentalHome.state}"/>

    <select id="stateSelect" name="state" class="state-select">
      <option value="1">운영중</option>
      <option value="2">중지</option>
    </select>

    <button class="status-button">상태 변경</button>

    <script>
      // JavaScript로 DB에서 가져온 값을 사용하여 기본값 설정
      document.addEventListener('DOMContentLoaded', function() {
          // 서버에서 가져온 DB 값으로 기본값 설정
          var stateElement = document.getElementById('state').value;

          // select 요소를 가져오기
          var selectElement = document.getElementById('stateSelect');

          // DB에서 가져온 값과 일치하는 option을 선택
          for (var i = 0; i < selectElement.options.length; i++) {
              if (selectElement.options[i].value == stateElement) {
                  selectElement.options[i].selected = true;
                  break;
              }
          }
      });
    </script>
  </form>


  <br>
  <br>


  <form enctype='multipart/form-data'
        method='post'
        data-th-object="${rentalHome}">

    <h1>숙소 사진</h1>
    <br>
    <label class="input-file-button" for="photoInput">사진 추가</label>
    <br><br>
    <div id="image-container" class="image-container">
      <input type="file" multiple id="photoInput" name="photos" style="display:none;"
             onchange="photoCountAndDisplay(this.files)"/>
      <div class="image-wrapper" id="default-image">
        <img src="https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/icon/camera.png?type=w_sh&w=150&quality=100&sharp_amt=1.0&ttype=png">
      </div>
      <div class="image-wrapper uploaded-image"
           data-th-each="photo : ${rentalHome.rentalHomePhotos}" data-th-object="${photo}"
            data-th-data-uuidPhotoName="${photo.uuidPhotoName}" data-uuidPhotoName="a.gif">
          <img class="image-item"
              data-th-src="@{'https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/rentalHome/' + ${photo.uuidPhotoName}(type=f,w=265,h=252,faceopt=false,ttype=jpg)}"
              src="/home1.jpg"/>
          <button class="delete-button">X</button>
          <input class="image-description" type="text" placeholder="이미지 설명"
                 data-th-value="${photo.photoExplanation}"/>
      </div>
    </div>
    <br><br><br>

    <div class="info">
      <h1>숙소 기본 정보</h1>
      <br>
      <div>
        <input class="basic-info" data-th-value="*{name}" type="text" name="name" id="name" placeholder="숙소명">
      </div>
      <div>
        <textarea class="basic-info" data-th-text="*{explanation}" name="explanation" id="explanation"
                  placeholder="숙소 설명"></textarea>
      </div>
      <div>
        <textarea class="basic-info" data-th-text="*{rentalHomeRule}" name="rentalHomeRule" id="rentalHomeRule"
                  placeholder="숙소 이용규칙"></textarea>
      </div>
    </div>
    <br><br><br>


    <div class="info">
      <h1>숙소 위치</h1>
      <br>
      <section>
        <div id="map"></div>
      </section>
      <input type="hidden" name="lat" id="lat">
      <input type="hidden" name="lon" id="lon">
      <div>
        <input type="text" class="location-info" name="basicAddress" id="basicAddress"
               placeholder="기본 주소">
      </div>
      <div>
        <input type="text" class="location-info" name="detailAddress" id="detailAddress"
               placeholder="상세 주소">
      </div>
    </div>
    <br><br><br>

    <div class="info">
      <h1>요금 설정</h1>
      <div class="price-info">
        <br>
        <h4>이용요금(주 기준)</h4>
        <input type="number" data-th-value="*{price}" value="10000" name="price"
                          id="price" onkeyup="calc(this.value)"/>
      </div>
      <div class="price-info">
        <h4>청소비</h4>
        <input type="number" data-th-value="*{cleanFee}" value="100" name="cleanFee"
                   id="cleanFee" onkeyup="calc(this.value)"/>
      </div>
      <div class="price-info">
        <h4>정산금액</h4>
        <input readonly type="text" id="income"/>
      </div>
    </div>
    <br><br><br>

    <div class="info">
      <div class="duration-info">
      <h1>호스팅 기간</h1>
        <br>
        호스팅 시작일: <input readonly data-th-value='*{hostingStartDate}' id="hostingStartDate"
                        value="2024-03-24" name="hostingStartDate" type='date'>
      </div>
      <div class="duration-info">
        호스팅 종료일: <input data-th-value='*{hostingEndDate}' id="hostingEndDate"
                        value="2024-03-24" name="hostingEndDate" type='date'>
      </div>
    </div>
    <br><br><br>

    <h1>숙소 타입</h1>
    <div class="room-type">
      <div class="type-option" data-th-if="${theme.themeNo < 10}" data-th-each="theme : ${themeList}" data-th-object="${theme}">
        <div >
          <img class="icon" data-th-src="@{'https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/theme/' + ${theme.themeName} + .png(type=f,w=50,h=50,faceopt=false)}" alt="테마 이미지">
        </div>
        <div class="type-name" data-th-text="*{themeName}">모텔</div>
        <input type="radio" name="type" id="type"
               data-th-checked="${rentalHome.themes.indexOf(theme) != -1}"
               data-th-value="${theme.themeNo} + ',' + ${theme.themeName}">

      </div>
    </div>
    <br><br>

    <h1>숙소 테마</h1>
    <div class="room-theme">
      <!-- 반복되는 항목 -->
      <div class="theme-option" data-th-if="${theme.themeNo >= 10}" data-th-each="theme : ${themeList}" data-th-object="${theme}">
        <div>
          <img class="icon" data-th-src="@{'https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/theme/' + ${theme.themeName} + .png(type=f,w=50,h=50,faceopt=false)}" alt="테마 이미지">
        </div>
        <div class="theme-name" data-th-text="*{themeName}">테마 이름</div>
        <input type="checkbox" class="theme-checkbox" id="theme${theme.themeNo}" name="themeNos" data-th-value="*{themeNo}"
               data-th-checked="${rentalHome.themes.indexOf(theme) != -1}">
        <input type="hidden" class="themeNames" name="themeNames" data-th-value="*{themeName}"/>
      </div>
    </div>
    <br><br>

    <h1>숙소 시설</h1>
    <h4>숙소의 기본 시설 개수를 입력해주세요</h4>
    <div id="basic-facility">
      <div class="quantity">
        <a>인원</a>
        <i class="fa-solid fa-circle-minus"></i>
        <input type="number" name="capacity" id="capacity" value="0" data-th-value="${rentalHome.capacity}">
        <i class="fa-solid fa-circle-plus"></i>
      </div>


      <div class="quantity" data-th-if="${rentalHomeFacility.facilityNo < 4} " data-th-each="rentalHomeFacility : ${rentalHome.rentalHomeFacilities}"
           data-th-object="${rentalHomeFacility}">
        <a data-th-text="*{facilityName}">시설</a>
        <i class="fa-solid fa-circle-minus"></i>
        <input class="facilityCount input" type="number" name="facilityCount" data-th-value="*{facilityCount}"/>
        <i class="fa-solid fa-circle-plus"></i>
        <input class="facilityNames" type="hidden" name="facilityNames" data-th-value="*{facilityName}"/>
        <input class="facilityNos" type="hidden" name="facilityNos"
               data-th-value="*{facilityNo}"/>
      </div>
    </div>

    <br><br>
    <h1>숙소 편의시설</h1>
    <h4>편의시설을 최소 1개 이상 선택해주세요.</h4>
    <div class="convenience-facility">
      <div class="facility-option" data-th-if="${facility.facilityNo >= 10}"
           data-th-each="facility : ${facilityList}" data-th-object="${facility}">
        <div>
          <img class="icon"
               data-th-src="@{'https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/facility/' + *{facilityName} + .png(type=f,w=50,h=50,faceopt=false)}" alt="시설 이미지">

        </div>
        <a data-th-text="*{facilityName}"></a>
        <input class="facilityCount checkbox" type="checkbox" name="facilityCount" value="1" data-th-checked="${rentalHome.rentalHomeFacilities.indexOf(facility)} != -1"/>
        <input class="facilityNames" type="hidden" name="facilityNames" data-th-value="*{facilityName}"/>
        <input class="facilityNos" type="hidden" name="facilityNos" data-th-value="*{facilityNo}"/>
      </div>
    </div>
    <br>

    <div>
      <button id="modalButton" type="button">저  장</button>
      <button type="button"
              data-th-onclick="|location.href='@{rentalHomeList(hostNo=${session.loginUser.no})}'|">돌아가기
      </button>
    </div>


    <div id="modalWrap"> <!-- 모달 창을 감싸는 div -->
      <div id="modalBody">
        <p>저장하시겠습니까?</p>
        <button type="button" id="saveButton">등록</button>
        <button type="button" id="closeButton">취소</button>
      </div>
    </div>

  </form>



  <br>
</div>
<br>
<div data-th-replace="footer :: footer">꼬리말</div>

<script>
  var filesArray = []; // 이미지 배열
  var formData = new FormData(); // 폼데이터

  function calc() {
    const price = Number(document.getElementById("price").value);
    const cleanFee = Number(document.getElementById("cleanFee").value);
    document.getElementById("income").value = Math.round((price + cleanFee) * 0.97);
  }

  window.onload = calc();

  function submitForm() {
    formData.append('rentalHomeNo', document.getElementById('rentalHomeNo').value);

    formData.append('name', document.getElementById('name').value);
    formData.append('explanation', document.getElementById('explanation').value);
    formData.append('rentalHomeRule', document.getElementById('rentalHomeRule').value);

    let basicAddress = document.querySelector('#basicAddress').value;
    let detailAddress = document.querySelector('#detailAddress').value;
    formData.append('address', basicAddress + "." + detailAddress);
    formData.append('lat', document.querySelector('#lat').value);
    formData.append('lon', document.querySelector('#lon').value);

    formData.append('price', document.getElementById('price').value);
    formData.append('cleanFee', document.getElementById('cleanFee').value);
    formData.append('hostingStartDate', document.getElementById('hostingStartDate').value);
    formData.append('hostingEndDate', document.getElementById('hostingEndDate').value);

    formData.append('capacity', document.getElementById('capacity').value);

    formData.append('type', document.getElementById('type').value);

    // 모든 테마 요소들
    let checkedTheme = document.querySelectorAll('.theme-checkbox');

    // 각 체크박스 요소를 확인하여 선택된 값과 동일한 인덱스의 숨겨진 입력 필드들의 값을 form 데이터에 추가합니다.
    checkedTheme.forEach(function(e, index) {
        // 선택되었을 때
        if (e.checked) {
            // 값과 해당 인덱스의 숨겨진 입력 필드들의 값을 form 데이터에 추가합니다.
            formData.append('themeNos', e.value);
            formData.append('themeNames', document.querySelectorAll('.themeNames')[index].value);
        }
    });


    // 선택된 시설 요소들
    let checkedFacility = document.querySelectorAll('.facilityCount');
    let inputFacility = document.querySelectorAll('.facilityCount.input');

    checkedFacility.forEach(function(e, index) {
      // 값이 1 이상일 때(선택 또는 입력되었을 때, 기본 시설은 최소 1개 이상임)
      if (e.checked) {
        formData.append('facilityCount', e.value);
        formData.append('facilityNos', document.querySelectorAll('.facilityNos')[index].value);
        formData.append('facilityNames', document.querySelectorAll('.facilityNames')[index].value);
      }
    });

    inputFacility.forEach(function(e, index) {
      formData.append('facilityCount', e.value);
      formData.append('facilityNames', document.querySelectorAll('.facilityNames')[index].value);
      formData.append('facilityNos', document.querySelectorAll('.facilityNos')[index].value);

      console.log(document.querySelectorAll('.facilityNames')[index].value);
      console.log(document.querySelectorAll('.facilityNos')[index].value);
    });

    updateFormData(); // FormData 업데이트

    fetch('rentalHomeUpdate', {
      method: 'POST',
      body: formData
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.text();
    })
    .then(data => {
      console.log('Response data:', data);
        window.location.href = data; // 자동으로 리디렉션
    })
    .catch(error => {
      console.error('Error:', error);
    });

  }

  // FormData 업데이트 함수
  function updateFormData() {
    if (filesArray.length > 0) {
      filesArray.forEach(obj => {
        formData.append('photos', obj.file);
        formData.append('photoExplanations', obj.description.value);
      });
    }
    uploadedImage = document.querySelectorAll('.uploaded-image');

    uploadedImage.forEach(image => {
      formData.append('existFileNames', image.getAttribute('data-uuidPhotoName'));
    });
  }

  function photoCountAndDisplay(files) {
    let imageContainer = document.getElementById('image-container');
    let defaultImage = document.querySelector('#default-image');

    defaultImage.style.display = 'none';
    imageContainer.style.justifyContent = 'flex-start';

    for (var i = 0; i < files.length; i++) {
      let file = files[i];
      var reader = new FileReader();

      reader.onload = function (e) {
        var wrapper = document.createElement('div');

        wrapper.classList.add('image-wrapper');

        var imgElement = document.createElement('img');
        imgElement.classList.add('image-item');
        imgElement.src = e.target.result;
        wrapper.appendChild(imgElement);

        var descriptionInput = document.createElement('input');
        descriptionInput.type = 'text';
        descriptionInput.placeholder = '이미지 설명';
        descriptionInput.classList.add('image-description');
        descriptionInput.name = 'photoExplanations'; // 이미지 설명의 이름 설정
        wrapper.appendChild(descriptionInput);

        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'X';
        deleteButton.classList.add('delete-button');
        deleteButton.onclick = function () {
          checkPhotoCount();
        };
        console.log("dd");
        wrapper.appendChild(deleteButton);

        imageContainer.appendChild(wrapper);

        // 파일과 설명을 하나의 객체로 연결하여 배열에 추가
        filesArray.push({
          file: file,
          description: descriptionInput
        });
        descriptionInput.addEventListener('input', checkRequiredFields);
      checkRequiredFields();
      };

      reader.readAsDataURL(file);
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const deleteButtons = document.querySelectorAll('.delete-button');

    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const wrapper = button.closest('.image-wrapper');
            if (wrapper) {
                wrapper.remove();
            }
            checkRequiredFields();
            checkPhotoCount();
        });
    });

    const typeOptions = document.querySelectorAll('.type-option');
    const themeOptions = document.querySelectorAll('.theme-option');
    const facilityOptions = document.querySelectorAll('.facility-option');

    typeOptions.forEach(option => {
        option.addEventListener('click', function() {
            // 선택된 항목 해제
            typeOptions.forEach(otherOption => {
                otherOption.classList.remove('selected');
                otherOption.querySelector('input[type="radio"]').checked = false;
            });
            // 현재 항목 선택
            this.classList.add('selected');
            this.querySelector('input[type="radio"]').checked = true;
            checkRequiredFields();
        });
    });

    themeOptions.forEach(option => {
        option.addEventListener('click', function() {
            const checkbox = this.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked; // 클릭할 때마다 체크 여부를 반전시킴
            // 선택 클래스를 토글
            if (checkbox.checked) {
                this.classList.add('selected');
            } else {
                this.classList.remove('selected');
            }
            checkRequiredFields();
        });
    });

    facilityOptions.forEach(option => {
        option.addEventListener('click', function() {
            const checkbox = this.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked; // 클릭할 때마다 체크 여부를 반전시킴
            // 선택 클래스를 토글
            if (checkbox.checked) {
                this.classList.add('selected');
            } else {
                this.classList.remove('selected');
            }
            checkRequiredFields();
        });
    });

    const plusButtons = document.querySelectorAll('.fa-circle-plus');
    const minusButtons = document.querySelectorAll('.fa-circle-minus');

    plusButtons.forEach(button => {
        button.addEventListener('click', function() {
            const input = this.parentNode.querySelector('input[type="number"]');
            input.value = parseInt(input.value) + 1;
        });
    });

    minusButtons.forEach(button => {
        button.addEventListener('click', function() {
            const input = this.parentNode.querySelector('input[type="number"]');
            if (parseInt(input.value) > 0) {
                input.value = parseInt(input.value) - 1;
            }
        });
    });

    // 초기화 시 선택된 라디오 및 체크박스에 selected 클래스 추가
    document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
        radio.parentNode.classList.add('selected');
    });

    document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
        checkbox.parentNode.classList.add('selected');
    });

    // 등록 최종 확인 및 안내메시지 모달
    const modal = document.getElementById("modalWrap");

    document.querySelector("#modalButton").onclick= () => {
      modal.style.display = "block";
    }

    document.querySelector("#saveButton").onclick = () => {
      alert("성공적으로 저장되었습니다.");
      submitForm();
    }

    document.querySelector("#closeButton").onclick = () => {
      modal.style.display = "none";
    }
  });

  function checkRequiredFields() {
    // 기본 정보 검사
    let requiredFields = [
      document.getElementById('name'),
      document.getElementById('explanation'),
      document.getElementById('rentalHomeRule'),
      document.getElementById('basicAddress'),
      document.getElementById('detailAddress'),
      document.getElementById('price'),
      document.getElementById('cleanFee'),
      document.getElementById('hostingStartDate'),
      document.getElementById('hostingEndDate')
    ];
    let roomFacility = document.querySelectorAll(".roomFacility");

    let isEmpty = requiredFields.some(field => field && !field.value.trim());
    let isRoomEmpty = Array.prototype.slice.call(roomFacility).some(facility => Number(facility.value) <= 0);
    let imageCount = document.querySelectorAll('.image-wrapper');
    let radioChecked = document.querySelector('input[type="radio"]:checked');
    let roomCheckboxes = document.querySelectorAll('.facilityCount.checkbox:checked');
    let themeCheckboxes = document.querySelectorAll('.theme-checkbox:checked');

    let modalButton = document.querySelector('#modalButton');

    if (isEmpty || imageCount.length < 5 || isRoomEmpty || !radioChecked || roomCheckboxes.length == 0 || themeCheckboxes.length == 0) {
      modalButton.disabled = true;
      modalButton.style.backgroundColor = '#CCCCCC';
    } else {
      modalButton.disabled = false;
      modalButton.style.backgroundColor = '#35C5B3';
    }
  }


  // 변경 확인
  window.onload = function() {
    document.querySelectorAll('input').forEach(element => {
      element.addEventListener('change', checkRequiredFields);
    });

    document.querySelectorAll('input[type="checkbox"]').forEach(element => {
      element.addEventListener('change', checkRequiredFields);
    });

    document.querySelectorAll('input[type="radio"]').forEach(element => {
      element.addEventListener('change', checkRequiredFields);
    });

    checkRequiredFields();
  };

</script>
<script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCn7sXQ-7jFww0vK_pndKEMLEsJfMxAsmk&callback=initMap&v=weekly"
    defer>
</script>
<script data-th-inline="javascript">
  let map;
  let marker;
  let geocoder;
  let responseDiv;
  let response;
  let selectedLocation;
  let address;

  // google맵 생성
  function initMap() {
    const rentalHome = [[${rentalHome}]];
    const position = { lat:Number(rentalHome.lat) , lng:Number(rentalHome.lon) };

    map = new google.maps.Map(document.getElementById("map"), {
      zoom: 10,
      center: position,
      mapTypeControl: false,
    });
    geocoder = new google.maps.Geocoder();

    // 맵 안쪽에 들어갈 html -- 검색 창 및 버튼
    const inputText = document.createElement("input");

    inputText.type = "text";
    inputText.placeholder = "주소 검색";
    const submitButton = document.createElement("input");

    submitButton.type = "button";
    submitButton.value = "검색";
    submitButton.classList.add("button", "button-primary");

    const clearButton = document.createElement("input");

    clearButton.type = "button";
    clearButton.value = "초기화";
    clearButton.classList.add("button", "button-secondary");

    const selectButton = document.createElement("input");

    selectButton.type = "button";
    selectButton.value = "선택";
    selectButton.classList.add("button", "button-primary");
    selectButton.id = "select-button";

    response = document.createElement("pre");
    response.id = "response";
    response.innerText = "";
    responseDiv = document.createElement("div");
    responseDiv.id = "response-container";
    responseDiv.appendChild(response);


    map.controls[google.maps.ControlPosition.TOP_LEFT].push(inputText); // 주소 입력 박스
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(submitButton); // 주소 가져오기 버튼
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(clearButton); // 초기화 버튼
    map.controls[google.maps.ControlPosition.LEFT_TOP].push(responseDiv); // 주소 변환 결과값 출력 공간
    map.controls[google.maps.ControlPosition.RIGHT_TOP].push(selectButton);
    marker = new google.maps.Marker({
      map,
    });

    // 기존 주소값 넣기
    let basicAddressDiv = document.getElementById('basicAddress');
    let detailAddressDiv = document.getElementById('detailAddress');
    let latDiv = document.getElementById('lat');
    let lonDiv = document.getElementById('lon');

    address = rentalHome.address
    addressArr = address.split(".");

    basicAddressDiv.value = addressArr[0];
    detailAddressDiv.value = addressArr[1];
    latDiv.value = rentalHome.lat;
    lonDiv.value = rentalHome.lon;


    // 기존 주소 마커 표시
    geocode({ address: basicAddressDiv.value })

    map.addListener("click", (e) => {
     geocode({ location: e.latLng });
    });

    submitButton.addEventListener("click", () =>
     geocode({ address: inputText.value })
    );

    clearButton.addEventListener("click", () => {
      clear();
    });

    selectButton.addEventListener("click", () => {
      let addressInput =  document.getElementById('basicAddress');
      let detailAddressInput = document.getElementById('detailAddress');
      let lat = document.getElementById("lat");
      let lon = document.getElementById('lon');

      addressInput.value = address;
      detailAddressInput.value = null;
      lat.value = JSON.stringify(selectedLocation.lat());
      lon.value = JSON.stringify(selectedLocation.lng());
    });

    clear();
  }

  // 초기화
  function clear() {
    marker.setMap(null);
    responseDiv.style.display = "none";
  }

  // 주소 변환
  function geocode(request) {
    clear();
    geocoder
      .geocode(request)
      .then((result) => {
        const { results } = result;

        map.setCenter(results[0].geometry.location);
        marker.setPosition(results[0].geometry.location);
        marker.setMap(map);
        responseDiv.style.display = "block";

        address = results[0].formatted_address;
        selectedLocation = results[0].geometry.location;

        response.innerText = JSON.stringify(results[0].formatted_address, null, 2);
        return results;
      })
      .catch((e) => {
        alert("주소 변환 실패: " + e);
      });
  }
  function checkPhotoCount() {
    var index = filesArray.findIndex(obj => obj.file === file);
    if (index > -1) {
      filesArray.splice(index, 1);
      wrapper.remove();
    }

    let imageContainer = document.querySelector('.image-container');
    let wrapperCount = document.querySelectorAll('.image-wrapper').length;
    let defaultImage = document.querySelector('#default-image');

    if (wrapperCount === 1) {
      defaultImage.style.display = 'block';
      imageContainer.style.justifyContent = 'center';
      console.log(":hhj");
    }
  }
  window.initMap = initMap;
</script>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script data-th-src="@{/js/host/hostHeader.js}"></script>

</html>