<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>호스트 예약내역</title>
</head>
<body>

<div data-th-replace="host/hostHeader :: hostHeader">머리말</div>

<h1>승인 대기중 예약</h1>
<table border="1">
  <thead>
  <tr>
    <th>숙소명</th>
    <th>게스트명</th>
    <th>이용 기간</th>
    <th>남은 기간</th>

  </tr>
  </thead>
  <tbody>
  <!--
  1. 상태에 따라 출력되는 위치가 다르게 하려고 조건문을 사용함.
  2. 예약 승인/거절을 위해 테이블 안에 form 버튼을 추가하고 업데이트에 필요한 값을 hidden으로 보냄.
  3. 화면에 보여지는 값은 반복문으로 출력되며 페이지 컨트롤러로부터 받은 hostReservation의 값이 들어감.
   -->
  <tr data-th-if="${hostReservation.state == 0}" data-th-each="hostReservation : ${list}"
      data-th-object="${hostReservation}">
    <td data-th-text="*{rentalHomeName}">그레이트 호텔</td>
    <td data-th-text="*{memberName}">홍길동</td>
    <td data-th-text="${#dates.format(hostReservation.startDate,'yyyy-MM-dd')} +
    '~' + ${#dates.format(hostReservation.endDate,'yyyy-MM-dd')}">2024-02-01 ~ 2024-04-01
    </td>
    <td class="usage-status" data-th-data-start="${hostReservation.startDate}"
        data-th-data-end="${hostReservation.endDate}"></td>
    <td>
      <form
          action="update" data-th-action="@{reservationCheck}" method="post">
        <input name="hostNo" data-th-value="*{hostNo}" type="hidden">
        <input name="state" value="1" type="hidden">
        <input name="reservationNo" data-th-value="*{reservationNo}" type="hidden">
        <button>예약 승인</button>
      </form>
      <form
          action="update" data-th-action="@{reservationCheck}" method="post">
        <input name="hostNo" data-th-value="*{hostNo}" type="hidden">
        <input name="state" value="2" type="hidden">
        <input name="reservationNo" data-th-value="*{reservationNo}" type="hidden">
        <button>예약 거절</button>
      </form>
    <td>
  </tr>
  </tbody>
</table>

<div></div>

<h1>승인된 예약</h1>
<table border="1">
  <thead>
  <tr>
    <th>숙소명</th>
    <th>게스트명</th>
    <th>이용 기간</th>
    <th>남은 기간</th>
  </tr>
  </thead>
  <tbody>
  <tr data-th-if="${hostReservation.state == 2}" data-th-each="hostReservation : ${list}"
      data-th-object="${hostReservation}">
    <td data-th-text="*{rentalHomeName}">그레이트 호텔</td>
    <td data-th-text="*{memberName}">홍길동</td>
    <td data-th-text="${#dates.format(hostReservation.startDate,'yyyy-MM-dd')} +
    '~' + ${#dates.format(hostReservation.endDate,'yyyy-MM-dd')}">2024-02-01 ~ 2024-04-01
    </td>
    <td class="usage-status" data-th-data-start="${hostReservation.startDate}"
        data-th-data-end="${hostReservation.endDate}"></td>
  </tr>
  </tbody>
</table>

<h1>거절된 예약</h1>
<table border="1">
  <thead>
  <tr>
    <th>숙소명</th>
    <th>게스트명</th>
    <th>이용 기간</th>
  </tr>
  </thead>
  <tbody>
  <tr data-th-if="${hostReservation.state == 2}"
      data-th-each="hostReservation : ${list}" data-th-object="${hostReservation}">
    <td data-th-text="*{rentalHomeName}">그레이트 호텔</td>
    <td data-th-text="*{memberName}">홍길동</td>
    <td data-th-text="${#dates.format(hostReservation.startDate,'yyyy-MM-dd')} +
      '~' + ${#dates.format(hostReservation.endDate,'yyyy-MM-dd')}">2024-02-01 ~ 2024-04-01
    </td>
  </tr>
  </tbody>
</table>

<div data-th-replace="footer :: footer">꼬리말</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const today = new Date();
    const statusCells = document.querySelectorAll('.usage-status');

    statusCells.forEach(cell => {
      const startDate = new Date(cell.dataset.start);
      const endDate = new Date(cell.dataset.end);

      if (today < startDate) {
        cell.textContent = '남은 일수: ' + Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));
      } else if (today >= startDate && today <= endDate) {
        cell.textContent = '이용중';
      } else {
        cell.textContent = '이용 완료';
      }
    });
  });
</script>

</body>
</html>