<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>숙소 기본 입력 폼</title>
</head>

<style>
  .image-container {
    display: inline-block;
    text-align: center;
    margin-right: 20px;
    margin-top: 30px;
    position: relative;
  }
  .image-item {
    width: 265px;
    height: 252px;
    object-fit: cover;
    margin-bottom: 10px;
    position: relative; /* 이미지 상대 위치 설정 */
  }

  .image-description {
      width: 100%;
      box-sizing: border-box;
      position: absolute;
      bottom: 0;
      left: 0;
      margin: 0;
      padding: 5px;
  }

  .delete-button {
      background-color: red;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      position: absolute;
      top: 0; /* 이미지의 위쪽 여백 */
      right: 0; /* 이미지의 오른쪽 여백 */
      transform: translate(50%, -50%); /* 삭제 버튼을 이미지의 오른쪽 상단에 정확히 위치시키기 위해 */
  }
  .input-file-button{
    padding: 6px 25px;
    background-color:#35C5B3;
    border-radius: 4px;
    color: white;
    cursor: pointer;
  }
</style>
<body>


<div data-th-replace="host/hostHeader :: hostHeader">머리말</div>

<div align="center">
<form id="myForm" enctype="multipart/form-data" method='post'>
  <br>

  <h2>숙소 기본 정보</h2>
  <div>
     <input type="text" name="name" id="name" placeholder="숙소명">
  </div>
  <div>
     <textarea name="explanation" id="explanation" placeholder="숙소 설명"></textarea>
  </div>
  <div>
     <textarea name="rentalHomeRule" id="rentalHomeRule" placeholder="숙소 이용규칙"></textarea>
  </div>

  <br>
  <br>
  <br>

  <h2>숙소 위치</h2>
  <div>
    지도 API 들어감
  </div>
  <div>
    임시 지역 값: <input type="text" id="region_no" name="regionNo" value="2">
  </div>
  <div>
    임시 주소 값: <input type="text" id="address" name="address" value="대한민국 제주도 제주 중앙로 304">
  </div>
  <div>
    임시 위도 값: <input type="text" id="lat" name="lat" value="33.493496809557">
  </div>
  <div>
    임시 경도 값: <input type="text" id="lon" name="lon" value="126.534302173485">
  </div>
  <br>
  <br>
  <br>

  <h2>숙소 사진</h2>


  <script>
    var filesArray = []; // 이미지 배열
    var formData = new FormData(); // 폼데이터

    function submitForm() {
      formData.append('name', document.querySelector('#name').value);
      formData.append('explanation', document.querySelector('#explanation').value);
      formData.append('rentalHomeRule', document.querySelector('#rentalHomeRule').value);

      formData.append('region_no', document.querySelector('#region_no').value);
      formData.append('address', document.querySelector('#address').value);
      formData.append('lat', document.querySelector('#lat').value);
      formData.append('lon', document.querySelector('#lon').value);

      formData.append('price', document.querySelector('#price').value);
      formData.append('cleanFee', document.querySelector('#cleanFee').value);
      formData.append('hostingStartDate', document.querySelector('#hostingStartDate').value);
      formData.append('hostingEndDate', document.querySelector('#hostingEndDate').value);

      updateFormData(); // FormData 업데이트

      console.log(formData.getAll('photoExplanations'));
      console.log(formData.getAll('photos'));

      fetch('rentalHomeSave', {
        method: 'POST',
        body: formData

      }).then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();

      }).then(data => {
        console.log('Response data:', data);
        window.location.href = "themeForm"; // 자동으로 리디렉션

      }).catch(error => {
        console.error('Error:', error);
      });
    }

    // FormData 업데이트 함수
    function updateFormData() {
      filesArray.forEach(obj => {
        formData.append('photos', obj.file);
        formData.append('photoExplanations', obj.description.value);
      });
    }

    function photoCountAndDisplay(files) {
      var imageContainer = document.getElementById('imageContainer');

      for (var i = 0; i < files.length; i++) {
        let file = files[i];
        var reader = new FileReader();

        reader.onload = function (e) {
          var container = document.createElement('div');
          container.classList.add('image-container');

          var imgElement = document.createElement('img');
          imgElement.classList.add('image-item');
          imgElement.src = e.target.result;
          container.appendChild(imgElement);

          var descriptionInput = document.createElement('input');
          descriptionInput.type = 'text';
          descriptionInput.placeholder = '이미지 설명';
          descriptionInput.classList.add('image-description');
          descriptionInput.name = 'photoExplanations'; // 이미지 설명의 이름 설정
          container.appendChild(descriptionInput);

          var deleteButton = document.createElement('button');
          deleteButton.textContent = 'X';
          deleteButton.classList.add('delete-button');
          deleteButton.onclick = function () {
            var index = filesArray.findIndex(obj => obj.file === file);
            if (index > -1) {
              filesArray.splice(index, 1);
              container.remove();
            }
          };
          container.appendChild(deleteButton);

          imageContainer.appendChild(container);

          // 파일과 설명을 하나의 객체로 연결하여 배열에 추가
          filesArray.push({
            file: file,
            description: descriptionInput
          });
        };

        reader.readAsDataURL(file);
      }
    }
  </script>
  <div>
    <label class="input-file-button" for="photoInput">사진 추가</label>
    <input type="file" multiple id="photoInput" name="photos" style="display:none;"
           onchange="photoCountAndDisplay(this.files)"/>
    <div id="imageContainer"></div>
  </div>

  <br>
  <br>
  <br>

  <h2>요금설정</h2>
  <script>
    function calc() {
      const price = Number(document.getElementById("price").value);
      const cleanFee = Number(document.getElementById("cleanFee").value)
      document.getElementById("income").value = Math.round((price + cleanFee) * 0.97)
    }
  </script>
    <div>
      <input type="number" name="price" id="price" placeholder="이용요금(주 기준)" onkeyup="calc(this.value)">
    </div>
    <div>
      <input type="number" name="cleanFee" id="cleanFee" placeholder="청소비" onkeyup="calc(this.value)">
    </div>
    <div>
     <input readonly type="text" id="income" placeholder="정산금액">
    </div>


  <br>
  <br>
  <br>

  <h2>호스팅 기간</h2>
  <div>
    호스팅 시작일: <input name='hostingStartDate' id="hostingStartDate" type='date'>
  </div>
  <div>
    호스팅 종료일: <input name='hostingEndDate' id="hostingEndDate" type='date'>
  </div>

  <h2>본인 인증</h2>
  <div>
    휴대폰인증
  </div>

  <br>
  <br>
  <br>

</form>

  <div>
    <button type="submit" onclick="submitForm()">다음</button>
  </div>

  <br>
  <br>
</div>



<div data-th-replace="footer :: footer">꼬리말</div>



</body>
</html>