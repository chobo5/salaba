<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>한달살기-관리자페이지</title>
    <link rel="stylesheet" type="text/css"  href="../css/form.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.js"></script>
</head>
<body>
<div id="mainHeader">
    <img id="logo" src="https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/logo/newLogo2.png?type=w_sh&w=150&quality=100&sharp_amt=1.0&ttype=png"/>
    <h1 id="title">관리자 페이지</h1>
</div>
<div class="login">
    <form id="loginForm" data-th-action="@{/auth/login}" method="post">
        <div id="email"> <input type="text" name="email" placeholder="이메일"/></div>
        <div id="pw"><input type="password" name="password" placeholder="비밀번호"/></div>
        <button type="button" id="signIn">로그인</button>
    </form>
    <a data-th-href="@{/signup}">가입하기</a>
</div>

</body>
</html>

<script>
    $('#signIn').click((e) => {
        let email = $('#email').children().first().val();
        let pw = $('#pw').children().first().val();
        let jsonData = {
                email: email,
                password: pw
            }
        $.ajax({
            url: '/auth/login',
            type: 'POST',
            contentType: 'application/json',
            dataType: 'json',
            data: JSON.stringify(jsonData),

            success: (response) => {
                console.log(response.accessToken);
                sessionStorage.setItem('accessToken', response.accessToken);
                moveNext('/home');
            },
            error: (error) => {
                alert('유효하지 않거나 권한이 없습니다.')
            }
        });
    });

    function moveNext(url) {
        var accessToken = sessionStorage.getItem('accessToken');
        console.log(accessToken);
        // 만약 accessToken이 존재한다면
        if (accessToken) {
            // 헤더에 accessToken을 담음
            $.ajaxSetup({
                headers: {
                    'Authorization': 'Bearer ' + accessToken
                }
            });
        }

        // 새로운 URL로 이동
        window.location.href = url;
    }
</script>



