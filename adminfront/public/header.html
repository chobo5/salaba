<div id="mainHeader">
  <div class="logo-container">
    <img
      id="logo"
      src="https://5ns6sjke2756.edge.naverncp.com/nBMc0TCJiv/logo/newLogo1.png?type=w_sh&w=150&quality=100&sharp_amt=1.0&ttype=png"
    />
    <h1 id="title">관리자 페이지</h1>
  </div>
  <div class="login-info">
    <span id="timer"></span>
    <button id="extendToken">연장</button>
    <span id="userName"></span>
    <a id="logout">로그아웃</a>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  #mainHeader {
    position: absolute; /* 절대적인 위치 설정 */
    top: 0; /* 상단에 위치 */
    left: 0; /* 좌측에 위치 */
    padding: 10px; /* 내부 여백 설정 */
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
  }
  

  #logo {
    vertical-align: middle; /* 수직 정렬 */
  }

  #title {
    display: inline-block; /* 요소를 인라인 블록 요소로 설정하여 다른 요소와 가로로 나란히 정렬 */
    margin: 0; /* 여백 제거 */
    padding-left: 10px; /* 텍스트와 이미지 사이의 간격 조정 */
    vertical-align: middle; /* 수직 정렬 */
  }

  .login-info {
    margin-right: 1%;
    width: 15%;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
  }

  #logout {
    cursor: pointer;
    transition: color 0.3s ease;
    left: 30px;
  }

  #logout:hover {
    color: red;
  }
</style>
<script>
  const accessToken = sessionStorage.getItem("accessToken");
  const userName = sessionStorage.getItem("name");
  $("#userName").text(userName);

  if (accessToken) {
    $(document).ready(function() {
    const initialDuration = 30 * 60; // 30 minutes in seconds
    const display = $('#timer');
    const extendButton = $('#extendToken');

    function startTimer(duration, display) {
        let timer = duration, minutes, seconds;
        const interval = setInterval(function () {
            localStorage.setItem('remainingTime', timer);

            minutes = Math.floor(timer / 60);
            seconds = timer % 60;

            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;

            display.text(minutes + ":" + seconds);

            if (--timer < 0) {
                clearInterval(interval);
                localStorage.removeItem('remainingTime');
                alert('Token expired! Please login again.');
            }
        }, 1000);
    }

    function getRemainingTime() {
        const savedTime = localStorage.getItem('remainingTime');
        if (savedTime) {
            return parseInt(savedTime, 10);
        }
        return initialDuration;
    }

    const remainingTime = getRemainingTime();
    startTimer(remainingTime, display);

    extendButton.click(function() {
        // $.ajax({
        //     url: '/api/token/extend', // Your server endpoint to extend the token
        //     method: 'POST',
        //     data: { refreshToken: getCookie('refreshToken') }, // Assuming refresh token is stored in cookie
        //     success: function(response) {
        //         localStorage.setItem('remainingTime', initialDuration); // Reset the timer
        //         startTimer(initialDuration, display);
        //         alert('Token extended successfully!');
        //     },
        //     error: function() {
        //         alert('Failed to extend token.');
        //     }
        // });

        localStorage.setItem('remainingTime', initialDuration); // Reset the timer
                startTimer(initialDuration, display);
    });

    // function getCookie(name) {
    //     const value = `; ${document.cookie}`;
    //     const parts = value.split(`; ${name}=`);
    //     if (parts.length === 2) return parts.pop().split(';').shift();
    // }
});
  }

  $("#logout").click((e) => {
    e.preventDefault();
    e.stopPropagation();
    // let refreshToken = sessionStorage.getItem("refreshToken");
    if (accessToken) {
      // const logoutData = {
      //   refreshToken: refreshToken
      // }
      Swal.fire({
        title: "로그아웃 하시겠습니까?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "로그아웃",
        cancelButtonText: "취소",
      }).then((result) => {
        if (result.isConfirmed) {
          axios
            .delete(`${RESTAPI_HOST}/auth/logout`)
            .then((response) => {
              Swal.fire({
                icon: "success",
                title: "로그아웃 되었습니다.",
                showConfirmButton: false,
                timer: 1000,
              }).then(() => {
                window.location.href = "/";
              });
            })
            .catch((error) => {
              Swal.fire({
                title: "로그아웃에 실패하였습니다.",
                icon: "error",
              });
            });
        }
      });
    }
  });

  $("#logo").click((e) => {
    window.location.href = "/home";
  });
</script>
